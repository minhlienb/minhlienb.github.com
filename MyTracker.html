<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Data collector</title>
    <link rel="icon" type="image/x-icon" href="assets/MyTracker.ico">
</head>
<body>
    <Button onclick="Confirm()">Calculate</Button>
    <button onclick="alert(CalculateDurration(1) + ' tiếng' + '\n\n' + savedTime)">Show recent</button>
    <p id="avgView">nuts/Day: </p>
    <h2 id="RecentDurration"></h2>
    <p id="data"></p>
</body>
<style>

</style>

<script src="lib/jquery-3.6.2.min.js"></script>
<script>
    // (function () {
    //     localStorage.setItem('originDate', 'Fri Apr 19 2024 07:21:00 GMT+0700 (Indochina Time)')
    //     localStorage.setItem('savedDurationList', '[3.667,20.55,23.367,6.367,17.617,23.983,7.217,45.4338,12.8897,7.8739,3.6086,19.4675,13.8939]');
    //     alert('Done!' + localStorage.getItem('originDate'));
    // })()
    const avgView = document.querySelector("#avgView");
    const dataView = document.querySelector("#data");
    const recentDurr = document.querySelector("#RecentDurration");
    const dt = new Date();
    var savedTime = dt.toString();
    var savedDurationList = []; // ["0:11", "24:19"];
    LoadData();
    avgView.innerHTML += savedDurationList.length / (TimeBetweenTwoDates(dt, new Date(localStorage.getItem('originDate'))) + 1);

    function TimeBetweenTwoDates(date1, date2) {
        let timeDiffInMS = Math.abs(date2 - date1);
        return Math.floor(timeDiffInMS / (1000 * 60 * 60 * 24));  
    }
    
    function CalculateDurration(floatingPoint) {
        let timeD1 = new Date(savedTime);
        let timeD2 = new Date();
        let timeDiffInMS = Math.abs(timeD2 - timeD1);
        let timeDiffInHM = Number((timeDiffInMS / 3600000).toFixed(floatingPoint));
        return timeDiffInHM;
    }

    function Calculate() {
        let timeD1 = new Date(savedTime);
        let timeD2 = new Date();
        let timeDiffInMS = Math.abs(timeD2 - timeD1);
        let timeDiffInHM = Number((timeDiffInMS / 3600000).toFixed(4));
        recentDurr.innerHTML =  timeDiffInHM;
        savedDurationList.push(timeDiffInHM);
        savedTime = timeD2.toString();
        dataView.innerHTML = savedDurationList;
        SaveData();
    }

    function SaveData() {
        localStorage.setItem('savedTime', dt.toString());
        localStorage.setItem('savedDurationList', JSON.stringify(savedDurationList));
        return "done!"
    };

    function LoadData() {
        var keysavedTime = localStorage.getItem('savedTime');
        var keysavedDurationList = localStorage.getItem('savedDurationList');
        if (keysavedTime === null || keysavedTime === '' || keysavedTime === undefined) {
            alert("Không có giá trị cũ, tự lấy giá trị là thời gian hiện tại")
        } else {
            savedTime = keysavedTime;
        }

        if (keysavedDurationList === null || keysavedDurationList === '' || keysavedDurationList === undefined) {
            alert("Không có giá trị cũ danh sách hiện tại trống")
        } else {
            savedDurationList = JSON.parse(keysavedDurationList);
            dataView.innerHTML = savedDurationList;
        }
    };

    function Confirm() {
        if (confirm("Xác nhận?")) {
            Calculate();
        } else {
            // Do nothing
        }
    }
</script>

</html>